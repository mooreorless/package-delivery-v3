!function(){function e(e,r){e.when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/profile",{templateUrl:"/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/orders",{templateUrl:"/orders/orders.view.html",controller:"OrderCtrl",controllerAs:"vm"}).when("/orders/new",{templateUrl:"/orders/newOrder.view.html",controller:"newOrderCtrl",controllerAs:"vm"}).when("/order/:orderID",{templateUrl:"/orders/singleOrder.view.html",controller:"singleOrderCtrl",controllerAs:"vm"}).when("/label/:orderID",{templateUrl:"/orders/label.view.html",controller:"labelCtrl",controllerAs:"vm"}).when("/update/details",{templateUrl:"auth/update/details/user.view.html",controller:"updateUserCtrl",controllerAs:"vm"}).when("/admin/dashboard",{templateUrl:"/admin/dashboard/dashboard.view.html",controller:"DashBoardCtrl",controllerAs:"vm"}).when("/admin/dashboard/item",{templateUrl:"/admin/dashboard/individual-item/individual-item.view.html",controller:"ItemDashBoardCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/login"}),r.html5Mode(!0)}function r(e,r,t,o){e.$on("$routeChangeStart",function(e,t,n){if(!o.isLoggedIn())switch(r.path()){case"/profile":console.log("login to view profile");break;case"/orders":console.log("login to view orders"),console.log("if user is logged in message with watermark here");break;case"/orders/new":console.log("login to make an order")}})}angular.module("packageDelivery",["ngRoute","toastr","ngMap"]),angular.module("packageDelivery",["ngRoute","toastr","ngMap"]).config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","$window","functionService",r])}(),function(){function e(e,r,t){console.log("Home controller is running"),r.hidden="/login"==e.path()}angular.module("packageDelivery").controller("homeCtrl",e),e.$inject=["$location","$scope","functionService"]}(),function(){function e(e,r,t,o,n,s){var l=this;l.orderID=t.orderID,n.getSingleOrder(l.orderID).error(function(e){e&&alert(e)}).then(function(){l.order=n.loadSingleOrder()}).then(function(){l._id=l.order._id,console.log(l),l.pickUpAddress=l.order.pickUpNumber+" "+l.order.pickUpName+" "+l.order.pickUpSuburb+" "+l.order.pickUpPostcode,l.dropOffAddress=l.order.dropOffNumber+" "+l.order.dropOffName+" "+l.order.dropOffSuburb+" "+l.order.dropOffPostcode})}angular.module("packageDelivery").controller("labelCtrl",e),e.$inject=["$location","$rootScope","$routeParams","$route","functionService","NgMap"]}(),function(){function e(e,r,t,o,n){function s(){return l()&&a()&&d()&&c()&&i()&&u()&&m()&&g()}function l(){var e=document.getElementById("pickUpNumber").value,r=/[a-zA-Z]/;return!r.test(e)&&""!=e||(p("pickUpNumber","Error: Please enter a valid pick up street number"),!1)}function a(){var e=document.getElementById("pickUpName").value,r=/[0-9]/;return!r.test(e)&&""!=e||(p("pickUpName","Error: Please enter a valid pick up street name"),!1)}function d(){var e=document.getElementById("pickUpSuburb").value,r=/[0-9]/;return!r.test(e)&&""!=e||(p("pickUpSuburb","Error: Please enter a valid pick up suburb"),!1)}function c(){var e=document.getElementById("pickUpPostcode").value,r=/[a-zA-Z]/,t=/([0-3][0-9]{3})|([5-9][0-9]{3})/;return!(r.test(e)||t.test(e)||""==e||e.length>4||e.length<4)||(p("pickUpPostcode","Error: Please enter a valid QLD pick up postcode"),!1)}function i(){var e=document.getElementById("dropOffNumber").value,r=/[a-zA-Z]/;return!r.test(e)&&""!=e||(p("dropOffNumber","Error: Please enter a valid delivery street number"),!1)}function u(){var e=document.getElementById("dropOffName").value,r=/[0-9]/;return!r.test(e)&&""!=e||(p("dropOffName","Error: Please enter a valid delivery street name"),!1)}function m(){var e=document.getElementById("dropOffSuburb").value,r=/[0-9]/;return!r.test(e)&&""!=e||(p("dropOffSuburb","Error: Please enter a valid delivery suburb"),!1)}function g(){var e=document.getElementById("dropOffPostcode").value,r=/[a-zA-Z]/,t=/([0-3][0-9]{3})|([5-9][0-9]{3})/;return!(r.test(e)||t.test(e)||""==e||e.length>4||e.length<4)||(p("dropOffPostcode","Error: Please enter a valid QLD delivery postcode"),!1)}function p(e,r){document.getElementById(e).style.borderColor="red",document.getElementById(e).focus(),document.getElementById("order-error-msg").innerHTML=r,document.getElementById("order-error-msg").style.display="block"}var f=this;f.currentUser={},f.isLoggedIn=o.isLoggedIn(),t.getProfile().success(function(e){f.currentUser=e,console.log(e),f.newOrder={userID:f.currentUser._id,userName:f.currentUser.firstName+" "+f.currentUser.lastName,pickUpNumber:f.currentUser.streetNumber,pickUpName:f.currentUser.streetName,pickUpSuburb:f.currentUser.suburb,pickUpPostcode:f.currentUser.postCode,dropOffNumber:"",dropOffName:"",dropOffSuburb:"",dropOffPostcode:"",notes:"",isFragile:"",isExpress:"",state:"Order Placed",pickUpDate:""},console.log(f.newOrder)}).error(function(r){n.error("Please sign in or make an account","Error"),e.path("/"),console.log(r)}),f.onSubmit=function(){s()&&(console.log("Placing Order"),console.log(f.newOrder),o.placeOrder(f.newOrder).error(function(e){console.log(e),n.error(e,"Error")}).then(function(){e.path("orders")}))}}angular.module("packageDelivery").controller("newOrderCtrl",e),e.$inject=["$location","$rootScope","meanData","functionService","toastr"]}(),function(){function e(e,r,t,o,n,s){var l=this;l.currentUser={},l.ordersMessage="",l.filter="",l.isLoggedIn=n.isLoggedIn(),o.getProfile().success(function(e){l.currentUser=e,"driver"===n.loggedInUserType()?l.ordersMessage="Displaying orders assigned to you "+l.currentUser.firstName:"customer"===n.loggedInUserType()?l.ordersMessage="Displaying orders placed by you "+l.currentUser.firstName:l.ordersMessage="Displaying all orders"}).error(function(r){s.error("Please sign in or make an account","Error"),e.path("/")}).then(function(){"admin"===n.loggedInUserType()?n.getCurrentOrders().then(function(){l.orders=n.loadOrders()}).then(function(){l.orders.forEach(function(e,r){e.seenByDriver===!1?l.orders[r].panelClass="panel panel-warning":l.orders[r].panelClass="panel panel-default"})}):n.getUserOrders(l.currentUser).error(function(e){s.warning(e,"Error")}).then(function(){l.orders=n.loadOrders(),l.newOrderCount=0,"driver"==n.loggedInUserType()?l.orders.forEach(function(e,r){e.seenByDriver===!1?l.orders[r].panelClass="panel panel-warning":l.orders[r].panelClass="panel panel-default"}):l.orders.forEach(function(e,r){l.orders[r].panelClass="panel panel-default"})})}),l.openOrder=function(r){console.log(r),e.path("order/"+r._id)}}angular.module("packageDelivery").controller("OrderCtrl",e),e.$inject=["$location","$rootScope","$route","meanData","functionService","toastr"]}(),function(){function e(e,r,t,o,n,s){var l=this;l.loggedInUserType=n.loggedInUserType,"customer"==l.loggedInUserType()?l.panelClass="col-md-8 col-md-offset-2":l.panelClass="col-md-8",l.orderID=t.orderID,l.googleMapsUrl='<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC0ZemKOuENUDXYGs4GVAVIbkPs3vyqJXA"></script>',n.getSingleOrder(l.orderID).error(function(e){e&&alert(e)}).then(function(){l.order=n.loadSingleOrder()}).then(function(){l.pickUpAddress=l.order.pickUpNumber+" "+l.order.pickUpName+" "+l.order.pickUpSuburb+" "+l.order.pickUpPostcode,l.dropOffAddress=l.order.dropOffNumber+" "+l.order.dropOffName+" "+l.order.dropOffSuburb+" "+l.order.dropOffPostcode,l.state=l.order.state,console.log(l.order),console.log(l.pickUpAddress),"driver"==l.loggedInUserType()&&l.order.seenByDriver===!1&&(console.log("calling mark job as seen"),n.markJobAsSeen({_id:l.order._id}))}),s.getMap().then(function(e){}),console.log(l.order),l.updateJobState=function(e){console.log("dropdown changed"),console.log(e),console.log(l.orderID),update={_id:l.orderID,state:e,pickedUpAt:l.order.pickedUpAt,droppedOffAt:l.order.droppedOffAt,paidAt:l.order.paidAt},"pickedup"==e.toLowerCase().replace(" ","")?(update.pickedUpAt=Date.now(),console.log("Picked Up Selected"),console.log(update)):"droppedoff"==e.toLowerCase().replace(" ","")?(update.droppedOffAt=Date.now(),console.log("Dropped Off Selected"),console.log(update)):"paid"==e.toLowerCase().replace(" ","")&&(update.paidAt=Date.now(),console.log("Paid At Selected"),console.log(update)),n.updateJobState(update).then(function(){n.getSingleOrder(l.orderID).error(function(e){e&&alert(e)}).then(function(){l.order=n.loadSingleOrder()}).then(function(){o.reload()})})}}angular.module("packageDelivery").controller("singleOrderCtrl",e),e.$inject=["$location","$rootScope","$routeParams","$route","functionService","NgMap"]}(),function(){function e(e,r,t,o){var n=this;n.user={},t.getProfile().success(function(e){n.user=e,console.log(e)}).error(function(r){o.error("Please sign in or make an account","Error"),e.path("/"),console.log(r)}),console.log(r.loggedInUserType()),$('[data-toggle="tooltip"]').tooltip(),n.view="Account","#FAQ"==window.location.hash&&(document.getElementById("help").className="active",document.getElementById("account").className="",document.getElementById("billing").className="",n.view="Help"),n.setView=function(e){switch(e){case"Account":document.getElementById("account").className="active",document.getElementById("billing").className="",document.getElementById("help").className="";break;case"Billing":document.getElementById("billing").className="active",document.getElementById("account").className="",document.getElementById("help").className="";break;case"Help":document.getElementById("help").className="active",document.getElementById("account").className="",document.getElementById("billing").className=""}n.view=e},n.updateDetails=function(){r.updateUser(n.user)}}angular.module("packageDelivery").controller("profileCtrl",e),e.$inject=["$location","functionService","meanData","toastr"]}(),function(){function e(e,r,t,o,n){var s=this,l=new Date;s.currentDate=l.getDate()+"/"+l.getMonth()+"/"+l.getFullYear(),s.selectedDriver="Select Driver",s.placedOrders=[],t.getAllDrivers().then(function(){s.drivers=t.loadDrivers()}),s.assignDriver=function(e){var r={_id:e._id,driverName:e.driverName.toLowerCase()};t.getJobCountForDriver(r.driverName).then(function(){s.jobs=t.loadOrders(),s.jobs.length>5?o.warning("This driver has too many jobs, please select another","Warning"):t.assignDriver(r)})},t.getCurrentOrders().then(function(){s.orders=t.loadOrders(),s.orders.forEach(function(e,r){"Order Placed"==e.state&&s.placedOrders.push(e)}),console.log(s.placedOrders[0].driver),s.allOrders=t.loadOrders(),s.currentOrderCount=s.orders.length}),t.getDeliveredOrders().then(function(){s.orders=t.loadOrders(),s.deliveredOrderCount=s.orders.length}),t.getPlacedOrders().then(function(){s.orders=t.loadOrders(),s.awaitingOrderCount=s.orders.length}),n.getMap().then(function(e){})}angular.module("packageDelivery").controller("DashBoardCtrl",e),e.$inject=["$location","$route","functionService","toastr","NgMap"]}(),function(){function e(e,r,t){var o=this;o.credentials={email:"",password:""},o.onSubmit=function(){r.login(o.credentials).error(function(e){document.getElementById("login-error-msg").style.display="block"}).then(function(){"admin"===r.loggedInUserType()?e.path("/admin/dashboard"):e.path("/profile")})}}angular.module("packageDelivery").controller("loginCtrl",e),e.$inject=["$location","functionService","toastr"]}(),function(){function e(e,r,t){function o(){return n()&&s()&&l()&&a()&&c()&&d()&&i()&&u()}function n(){var e=document.getElementById("firstName").value,r=/[0-9]/;return""===e?(document.getElementById("firstName").style.borderColor="red",document.getElementById("firstName").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a first name",document.getElementById("register-error-msg").style.display="block",!1):r.test(e)?(document.getElementById("firstName").style.borderColor="red",document.getElementById("firstName").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid first name",document.getElementById("register-error-msg").style.display="block",!1):(document.getElementById("firstName").style.borderColor="transparent",!0)}function s(){var e=document.getElementById("lastName").value,r=/[0-9]/;return""===e?(document.getElementById("lastName").style.borderColor="red",document.getElementById("lastName").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a last name",document.getElementById("register-error-msg").style.display="block",!1):r.test(e)?(document.getElementById("lastName").style.borderColor="red",document.getElementById("lastName").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid last name",document.getElementById("register-error-msg").style.display="block",!1):(document.getElementById("lastName").style.borderColor="transparent",!0)}function l(){var e=document.getElementById("email").value,r=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return""===e?(document.getElementById("email").style.borderColor="red",document.getElementById("email").focus(),document.getElementById("register-error-msg").innerHTML="Please enter an email",document.getElementById("register-error-msg").style.display="block",!1):r.test(e)?(document.getElementById("email").style.borderColor="transparent",!0):(document.getElementById("email").style.borderColor="red",document.getElementById("email").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid email",document.getElementById("register-error-msg").style.display="block",!1)}function a(){var e=document.getElementById("password").value;return e.length<5?(document.getElementById("password").style.borderColor="red",document.getElementById("password").focus(),document.getElementById("register-error-msg").innerHTML="Password cannot be less than 5 characters",document.getElementById("register-error-msg").style.display="block",!1):e.length>20?(document.getElementById("password").style.borderColor="red",document.getElementById("password").focus(),document.getElementById("register-error-msg").innerHTML="Password cannot be more than 20 characters",document.getElementById("register-error-msg").style.display="block",!1):(document.getElementById("password").style.borderColor="transparent",!0)}function d(){var e=document.getElementById("streetNumber").value,r=/[a-zA-Z]/;return!r.test(e)&&""!=e||(document.getElementById("streetNumber").style.borderColor="red",document.getElementById("streetNumber").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid street number",document.getElementById("register-error-msg").style.display="block",!1)}function c(){var e=document.getElementById("streetName").value,r=/[0-9]/;return!r.test(e)&&""!=e||(document.getElementById("streetName").style.borderColor="red",document.getElementById("streetName").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid street name",document.getElementById("register-error-msg").style.display="block",!1)}function i(){var e=document.getElementById("suburb").value,r=/[0-9]/;return!r.test(e)&&""!=e||(document.getElementById("suburb").style.borderColor="red",document.getElementById("suburb").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid suburb",document.getElementById("register-error-msg").style.display="block",!1)}function u(){var e=document.getElementById("postCode").value,r=/[a-zA-Z]/;return!(r.test(e)||""==e||e.length>4||e.length<4)||(document.getElementById("postCode").style.borderColor="red",document.getElementById("postCode").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid postcode",document.getElementById("register-error-msg").style.display="block",!1)}var m=this;m.credentials={firstName:"",lastName:"",email:"",password:"",streetNumber:"",streetName:"",suburb:"",postCode:""},m.onSubmit=function(){console.log("Submitting registration"),o()&&r.register(m.credentials).error(function(e){t.error("There's already an account registered with that email address","Error")}).then(function(){e.path("/profile")})}}angular.module("packageDelivery").controller("registerCtrl",e),e.$inject=["$location","functionService","toastr"]}(),function(){function e(e,r){var t=function(){return e.get("/api/profile",{headers:{Authorization:"Bearer "+r.getToken()}})};return{getProfile:t}}angular.module("packageDelivery").service("meanData",e),e.$inject=["$http","functionService"]}(),function(){function e(e,r,t,o){var n,s,l,a=function(e){r.localStorage["mean-token"]=e,console.log(e)},d=function(){return r.localStorage["mean-token"]},c=function(){var e,t=d();return t?(e=t.split(".")[1],e=r.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3):(console.log("not logged in"),!1)},i=function(){if(c()){var e=d(),t=e.split(".")[1];return t=r.atob(t),t=JSON.parse(t),{email:t.email,name:t.firstName,lastName:t.lastName,streetNumber:t.streetNumber,streetName:t.streetName,suburb:t.suburb,postCode:t.postCode}}},u=function(){if(c()){var e=d(),t=e.split(".")[1];return t=r.atob(t),t=JSON.parse(t),userEmail=t.email.split("@"),"onthespot.com"!=userEmail[1]?"customer":"admin"==userEmail[0]?"admin":"driver"}};return register=function(r){return console.log("register being called"),e.post("/api/register",r).success(function(e){t.success("Account created","Success"),a(e.token)})},login=function(r){return e.post("/api/login",r).success(function(e){a(e.token),t.success("Login successful","Success")})},updateUser=function(r){return e.put("/api/update/details",r).success(function(e){t.success("Updated profile","Success"),t.hidden("Hidden","Hidden"),console.log(e),a(e.token)})},logout=function(){r.localStorage.removeItem("mean-token"),o.path("/login")},placeOrder=function(r){return console.log("calling placeOrder"),e.post("/api/orders/new",r).success(function(e){t.success("Order placed","Success"),t.hidden("Hidden","Hidden"),console.log(e)})},getUserOrders=function(r){return e.get("/api/orders",{params:{user:r}}).success(function(e){n=e})},loadOrders=function(){return n},getSingleOrder=function(r){return e.get("/api/singleOrder",{params:{orderID:r}}).success(function(e){s=e})},loadSingleOrder=function(){return s},markJobAsSeen=function(r){return e.put("/api/update/jobSeen",r).success(function(e){console.log(r+" marked as seen!")})},getCurrentOrders=function(){return e.get("/api/orders/current").success(function(e){n=e})},getDeliveredOrders=function(){return e.get("/api/orders/delivered").success(function(e){n=e})},getPlacedOrders=function(){return e.get("/api/orders/awaiting").success(function(e){n=e})},updateJobState=function(r){return e.put("/api/update/jobstate",r).success(function(e){t.success("Job State Changed","Success")})},loadDrivers=function(){return l},getAllDrivers=function(){return e.get("/api/drivers/all").success(function(e){l=e})},assignDriver=function(r){return e.put("/api/orders/assign/driver",r).success(function(e){var r=e.driver.charAt(0).toUpperCase()+e.driver.slice(1);t.success("Assigned to "+r)})},getJobCountForDriver=function(r){return e.get("/api/orders/driver",{params:{driverName:r}}).success(function(e){n=e})},{currentUser:i,saveToken:a,getToken:d,isLoggedIn:c,register:register,login:login,updateUser:updateUser,logout:logout,placeOrder:placeOrder,getUserOrders:getUserOrders,orders:n,loadOrders:loadOrders,getSingleOrder:getSingleOrder,loadSingleOrder:loadSingleOrder,getCurrentOrders:getCurrentOrders,getDeliveredOrders:getDeliveredOrders,getPlacedOrders:getPlacedOrders,order:s,loggedInUserType:u,updateJobState:updateJobState,drivers:l,loadDrivers:loadDrivers,getAllDrivers:getAllDrivers,assignDriver:assignDriver,getJobCountForDriver:getJobCountForDriver,markJobAsSeen:markJobAsSeen}}angular.module("packageDelivery").service("functionService",e),e.$inject=["$http","$window","toastr","$location"]}(),function(){function e(e,r){}angular.module("packageDelivery").controller("ItemDashBoardCtrl",e),e.$inject=["$location","toastr"]}(),function(){function e(e,r,t){var o=this;o.isLoggedIn=r.isLoggedIn(),o.currentUser=r.currentUser(),console.log(o.currentUser.lastName),console.log(o.currentUser),o.newCredentials={firstName:o.currentUser.name,lastName:o.currentUser.lastName,email:o.currentUser.email,streetNumber:o.currentUser.streetNumber,streetName:o.currentUser.streetName,suburb:o.currentUser.suburb,postCode:o.currentUser.postCode},o.credentials={firstName:o.currentUser.name,lastName:o.currentUser.lastName,email:o.currentUser.email,streetNumber:o.currentUser.streetNumber,streetName:o.currentUser.streetName,suburb:o.currentUser.suburb,postCode:o.currentUser.postCode},o.updateUser=function(){r.updateUser(o.newCredentials),e.path("/profile")}}angular.module("packageDelivery").controller("updateUserCtrl",e),e.$inject=["$location","functionService","toastr"]}(),function(){function e(e,r,t){var o=this,n=e.path();o.userType="","/orders"==n?(document.getElementById("myOrders").className="active",document.getElementById("newOrder").className="",document.getElementById("myProfile").className=""):"/orders/new"==n?(document.getElementById("myOrders").className="",document.getElementById("newOrder").className="active",document.getElementById("myProfile").className=""):"/profile"==n?(document.getElementById("myOrders").className="",document.getElementById("newOrder").className="",document.getElementById("myProfile").className="active"):"/admin/dashboard"===n&&(document.getElementById("myOrders").className="",document.getElementById("newOrder").className="",document.getElementById("myProfile").className="",document.getElementById("dashboard").className="active"),o.isLoggedIn=r.isLoggedIn(),o.currentUser=r.currentUser();var s=r.loggedInUserType();switch(s){case"driver":o.userType="driver";break;case"admin":o.userType="admin";break;case"customer":o.userType="customer"}o.logout=function(){r.logout(),t.warning("You have logged out","Warning")}}angular.module("packageDelivery").controller("navigationCtrl",e),e.$inject=["$location","functionService","toastr"]}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("packageDelivery").directive("navigation",e)}();