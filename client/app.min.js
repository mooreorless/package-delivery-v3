!function(){function e(e,r){e.when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/profile",{templateUrl:"/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/orders",{templateUrl:"/orders/orders.view.html",controller:"OrderCtrl",controllerAs:"vm"}).when("/orders/new",{templateUrl:"/orders/newOrder.view.html",controller:"newOrderCtrl",controllerAs:"vm"}).when("/order/:orderID",{templateUrl:"/orders/singleOrder.view.html",controller:"singleOrderCtrl",controllerAs:"vm"}).when("/label/:orderID",{templateUrl:"/orders/label.view.html",controller:"labelCtrl",controllerAs:"vm"}).when("/update/details",{templateUrl:"auth/update/details/user.view.html",controller:"updateUserCtrl",controllerAs:"vm"}).when("/admin/dashboard",{templateUrl:"/admin/dashboard/dashboard.view.html",controller:"DashBoardCtrl",controllerAs:"vm"}).when("/admin/dashboard/:orderID",{templateUrl:"/admin/dashboard/individual-item/individual-item.view.html",controller:"singleOrderCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/login"}),r.html5Mode(!0)}function r(e,r,t,n){e.$on("$routeChangeStart",function(e,t,o){if(!n.isLoggedIn())switch(r.path()){case"/profile":console.log("login to view profile");break;case"/orders":console.log("login to view orders"),console.log("if user is logged in message with watermark here");break;case"/orders/new":console.log("login to make an order")}})}angular.module("packageDelivery",["ngRoute","toastr","ngMap"]),angular.module("packageDelivery",["ngRoute","toastr","ngMap"]).config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","$window","functionService",r])}(),function(){function e(e,r,t,n){var o=this;o.user={},t.getProfile().success(function(e){o.user=e,console.log(e)}).error(function(r){n.error("Please sign in or make an account","Error"),e.path("/"),console.log(r)}),console.log(r.loggedInUserType()),$('[data-toggle="tooltip"]').tooltip(),o.view="Account","#FAQ"==window.location.hash&&(document.getElementById("help").className="active",document.getElementById("account").className="",document.getElementById("billing").className="",o.view="Help"),o.setView=function(e){switch(e){case"Account":document.getElementById("account").className="active",document.getElementById("billing").className="",document.getElementById("help").className="";break;case"Billing":document.getElementById("billing").className="active",document.getElementById("account").className="",document.getElementById("help").className="";break;case"Help":document.getElementById("help").className="active",document.getElementById("account").className="",document.getElementById("billing").className=""}o.view=e},o.updateDetails=function(){r.updateUser(o.user)}}angular.module("packageDelivery").controller("profileCtrl",e),e.$inject=["$location","functionService","meanData","toastr"]}(),function(){function e(e,r,t,n,o,s){var a=this;a.orderID=t.orderID,o.getSingleOrder(a.orderID).error(function(e){e&&alert(e)}).then(function(){a.order=o.loadSingleOrder()}).then(function(){a._id=a.order._id,console.log(a),a.pickUpAddress=a.order.pickUpNumber+" "+a.order.pickUpName+" "+a.order.pickUpSuburb+" "+a.order.pickUpPostcode,a.dropOffAddress=a.order.dropOffNumber+" "+a.order.dropOffName+" "+a.order.dropOffSuburb+" "+a.order.dropOffPostcode})}angular.module("packageDelivery").controller("labelCtrl",e),e.$inject=["$location","$rootScope","$routeParams","$route","functionService","NgMap"]}(),function(){function e(e,r,t,n,o){function s(){return a()&&l()&&d()&&i()&&c()&&u()&&m()&&g()}function a(){var e=document.getElementById("pickUpNumber").value,r=/[a-zA-Z]/;return!r.test(e)&&""!=e||(p("pickUpNumber","Error: Please enter a valid pick up street number"),!1)}function l(){var e=document.getElementById("pickUpName").value,r=/[0-9]/;return!r.test(e)&&""!=e||(p("pickUpName","Error: Please enter a valid pick up street name"),!1)}function d(){var e=document.getElementById("pickUpSuburb").value,r=/[0-9]/;return!r.test(e)&&""!=e||(p("pickUpSuburb","Error: Please enter a valid pick up suburb"),!1)}function i(){var e=document.getElementById("pickUpPostcode").value,r=/[a-zA-Z]/,t=/([0-3][0-9]{3})|([5-9][0-9]{3})/;return!(r.test(e)||t.test(e)||""==e||e.length>4||e.length<4)||(p("pickUpPostcode","Error: Please enter a valid QLD pick up postcode"),!1)}function c(){var e=document.getElementById("dropOffNumber").value,r=/[a-zA-Z]/;return!r.test(e)&&""!=e||(p("dropOffNumber","Error: Please enter a valid delivery street number"),!1)}function u(){var e=document.getElementById("dropOffName").value,r=/[0-9]/;return!r.test(e)&&""!=e||(p("dropOffName","Error: Please enter a valid delivery street name"),!1)}function m(){var e=document.getElementById("dropOffSuburb").value,r=/[0-9]/;return!r.test(e)&&""!=e||(p("dropOffSuburb","Error: Please enter a valid delivery suburb"),!1)}function g(){var e=document.getElementById("dropOffPostcode").value,r=/[a-zA-Z]/,t=/([0-3][0-9]{3})|([5-9][0-9]{3})/;return!(r.test(e)||t.test(e)||""==e||e.length>4||e.length<4)||(p("dropOffPostcode","Error: Please enter a valid QLD delivery postcode"),!1)}function p(e,r){document.getElementById(e).style.borderColor="red",document.getElementById(e).focus(),document.getElementById("order-error-msg").innerHTML=r,document.getElementById("order-error-msg").style.display="block"}var f=this;f.currentUser={},f.isLoggedIn=n.isLoggedIn(),t.getProfile().success(function(e){f.currentUser=e,console.log(e),f.newOrder={userID:f.currentUser._id,userName:f.currentUser.firstName+" "+f.currentUser.lastName,pickUpNumber:f.currentUser.streetNumber,pickUpName:f.currentUser.streetName,pickUpSuburb:f.currentUser.suburb,pickUpPostcode:f.currentUser.postCode,dropOffNumber:"",dropOffName:"",dropOffSuburb:"",dropOffPostcode:"",notes:"",isFragile:"",isExpress:"",state:"Order Placed",pickUpDate:""},console.log(f.newOrder)}).error(function(r){o.error("Please sign in or make an account","Error"),e.path("/"),console.log(r)}),f.onSubmit=function(){s()&&(console.log("Placing Order"),console.log(f.newOrder),n.placeOrder(f.newOrder).error(function(e){console.log(e),o.error(e,"Error")}).then(function(){e.path("orders")}))}}angular.module("packageDelivery").controller("newOrderCtrl",e),e.$inject=["$location","$rootScope","meanData","functionService","toastr"]}(),function(){function e(e,r,t,n,o,s){var a=this;a.currentUser={},a.ordersMessage="",a.filter="",a.isLoggedIn=o.isLoggedIn(),n.getProfile().success(function(e){a.currentUser=e,"driver"===o.loggedInUserType()?a.ordersMessage="Displaying orders assigned to you "+a.currentUser.firstName:"customer"===o.loggedInUserType()?a.ordersMessage="Displaying orders placed by you "+a.currentUser.firstName:a.ordersMessage="Displaying all orders"}).error(function(r){s.error("Please sign in or make an account","Error"),e.path("/")}).then(function(){"admin"===o.loggedInUserType()?o.getCurrentOrders().then(function(){a.orders=o.loadOrders()}).then(function(){a.orders.forEach(function(e,r){e.seenByDriver===!1?a.orders[r].panelClass="panel panel-warning":a.orders[r].panelClass="panel panel-default"})}):o.getUserOrders(a.currentUser).error(function(e){s.warning(e,"Error")}).then(function(){a.orders=o.loadOrders(),a.newOrderCount=0,"driver"==o.loggedInUserType()?a.orders.forEach(function(e,r){e.seenByDriver===!1?a.orders[r].panelClass="panel panel-warning":a.orders[r].panelClass="panel panel-default"}):a.orders.forEach(function(e,r){a.orders[r].panelClass="panel panel-default"})})}),a.openOrder=function(r){"admin"===o.loggedInUserType()?e.path("admin/dashboard/"+r._id):e.path("order/"+r._id)}}angular.module("packageDelivery").controller("OrderCtrl",e),e.$inject=["$location","$rootScope","$route","meanData","functionService","toastr"]}(),function(){function e(e,r,t,n,o,s,a){var l=this,d=new Date;l.currentDate=d.getDate()+"/"+d.getMonth()+"/"+d.getFullYear(),l.loggedInUserType=o.loggedInUserType,l.orderID=t.orderID,l.googleMapsUrl='<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC0ZemKOuENUDXYGs4GVAVIbkPs3vyqJXA"></script>',o.getSingleOrder(l.orderID).error(function(e){e&&alert(e)}).then(function(){l.order=o.loadSingleOrder(),l.order.pickedUpAt&&(l.pickedUpAtStatus="complete"),l.order.droppedOffAt&&(l.droppedOffAtStatus="complete"),l.order.paidAtStatus&&(l.paidAtStatus="complete")}).then(function(){l.pickUpAddress=l.order.pickUpNumber+" "+l.order.pickUpName+" "+l.order.pickUpSuburb+" "+l.order.pickUpPostcode,l.dropOffAddress=l.order.dropOffNumber+" "+l.order.dropOffName+" "+l.order.dropOffSuburb+" "+l.order.dropOffPostcode,l.state=l.order.state,l.driverName=l.order.driver.charAt(0).toUpperCase()+l.order.driver.slice(1),"driver"==l.loggedInUserType()&&l.order.seenByDriver===!1&&(console.log("calling mark job as seen"),o.markJobAsSeen({_id:l.order._id}))}),s.getMap(),l.validatePaymentDetails=function(){var e=l.cardNumber.replace(/-/g,""),e=e.replace(/ /g,""),r=/[0-9]{16}/,t=/[0-9]{3}/,n=/[0-1][1-9]\/[1-9][0-9]/;return!!(r.test(e)&&16==e.length&&t.test(l.cardCVV)&&3==l.cardCVV.length&&n.test(l.cardExp)&&5==l.cardExp.length)||(a.error("Invalid Payment Details","Error"),a.hidden("Hidden","Hidden"),!1)},l.updateJobState=function(e){return!("Paid"==e&&!l.validatePaymentDetails())&&(update={_id:l.orderID,state:e,pickedUpAt:l.order.pickedUpAt,droppedOffAt:l.order.droppedOffAt,paidAt:l.order.paidAt},"pickedup"==e.toLowerCase().replace(" ","")?update.pickedUpAt=Date.now():"droppedoff"==e.toLowerCase().replace(" ","")?update.droppedOffAt=Date.now():"paid"==e.toLowerCase().replace(" ","")&&(update.paidAt=Date.now()),void o.updateJobState(update).then(function(){o.getSingleOrder(l.orderID).error(function(e){e&&alert(e)}).then(function(){l.order=o.loadSingleOrder()}).then(function(){n.reload()})}))}}angular.module("packageDelivery").controller("singleOrderCtrl",e),e.$inject=["$location","$rootScope","$routeParams","$route","functionService","NgMap","toastr"]}(),function(){function e(e,r,t,n,o){var s=this,a=new Date;s.currentDate=a.getDate()+"/"+a.getMonth()+"/"+a.getFullYear(),s.selectedDriver="Select Driver",s.placedOrders=[],t.getAllDrivers().then(function(){s.drivers=t.loadDrivers()}),s.assignDriver=function(e){var r={_id:e._id,driverName:e.driverName.toLowerCase()};t.getJobCountForDriver(r.driverName).then(function(){s.jobs=t.loadOrders(),s.jobs.length>5?n.warning("This driver has too many jobs, please select another","Warning"):t.assignDriver(r)})},t.getCurrentOrders().then(function(){s.orders=t.loadOrders(),s.orders.forEach(function(e,r){"Order Placed"==e.state&&s.placedOrders.push(e)}),s.allOrders=t.loadOrders(),s.currentOrderCount=s.orders.length}),t.getDeliveredOrders().then(function(){s.orders=t.loadOrders(),s.deliveredOrderCount=s.orders.length}),t.getPlacedOrders().then(function(){s.orders=t.loadOrders(),s.awaitingOrderCount=s.orders.length}),o.getMap()}angular.module("packageDelivery").controller("DashBoardCtrl",e),e.$inject=["$location","$route","functionService","toastr","NgMap"]}(),function(){function e(e,r,t){var n=this;n.credentials={email:"",password:""},n.onSubmit=function(){r.login(n.credentials).error(function(e){document.getElementById("login-error-msg").style.display="block"}).then(function(){"admin"===r.loggedInUserType()?e.path("/admin/dashboard"):e.path("/profile")})}}angular.module("packageDelivery").controller("loginCtrl",e),e.$inject=["$location","functionService","toastr"]}(),function(){function e(e,r,t){function n(){return o()&&s()&&a()&&l()&&i()&&d()&&c()&&u()}function o(){var e=document.getElementById("firstName").value,r=/[0-9]/;return""===e?(document.getElementById("firstName").style.borderColor="red",document.getElementById("firstName").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a first name",document.getElementById("register-error-msg").style.display="block",!1):r.test(e)?(document.getElementById("firstName").style.borderColor="red",document.getElementById("firstName").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid first name",document.getElementById("register-error-msg").style.display="block",!1):(document.getElementById("firstName").style.borderColor="transparent",!0)}function s(){var e=document.getElementById("lastName").value,r=/[0-9]/;return""===e?(document.getElementById("lastName").style.borderColor="red",document.getElementById("lastName").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a last name",document.getElementById("register-error-msg").style.display="block",!1):r.test(e)?(document.getElementById("lastName").style.borderColor="red",document.getElementById("lastName").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid last name",document.getElementById("register-error-msg").style.display="block",!1):(document.getElementById("lastName").style.borderColor="transparent",!0)}function a(){var e=document.getElementById("email").value,r=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return""===e?(document.getElementById("email").style.borderColor="red",document.getElementById("email").focus(),document.getElementById("register-error-msg").innerHTML="Please enter an email",document.getElementById("register-error-msg").style.display="block",!1):r.test(e)?(document.getElementById("email").style.borderColor="transparent",!0):(document.getElementById("email").style.borderColor="red",document.getElementById("email").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid email",document.getElementById("register-error-msg").style.display="block",!1)}function l(){var e=document.getElementById("password").value;return e.length<5?(document.getElementById("password").style.borderColor="red",document.getElementById("password").focus(),document.getElementById("register-error-msg").innerHTML="Password cannot be less than 5 characters",document.getElementById("register-error-msg").style.display="block",!1):e.length>20?(document.getElementById("password").style.borderColor="red",document.getElementById("password").focus(),document.getElementById("register-error-msg").innerHTML="Password cannot be more than 20 characters",document.getElementById("register-error-msg").style.display="block",!1):(document.getElementById("password").style.borderColor="transparent",!0)}function d(){var e=document.getElementById("streetNumber").value,r=/[a-zA-Z]/;return!r.test(e)&&""!=e||(document.getElementById("streetNumber").style.borderColor="red",document.getElementById("streetNumber").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid street number",document.getElementById("register-error-msg").style.display="block",!1)}function i(){var e=document.getElementById("streetName").value,r=/[0-9]/;return!r.test(e)&&""!=e||(document.getElementById("streetName").style.borderColor="red",document.getElementById("streetName").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid street name",document.getElementById("register-error-msg").style.display="block",!1)}function c(){var e=document.getElementById("suburb").value,r=/[0-9]/;return!r.test(e)&&""!=e||(document.getElementById("suburb").style.borderColor="red",document.getElementById("suburb").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid suburb",document.getElementById("register-error-msg").style.display="block",!1)}function u(){var e=document.getElementById("postCode").value,r=/[a-zA-Z]/;return!(r.test(e)||""==e||e.length>4||e.length<4)||(document.getElementById("postCode").style.borderColor="red",document.getElementById("postCode").focus(),document.getElementById("register-error-msg").innerHTML="Please enter a valid postcode",document.getElementById("register-error-msg").style.display="block",!1)}var m=this;m.credentials={firstName:"",lastName:"",email:"",password:"",streetNumber:"",streetName:"",suburb:"",postCode:""},m.onSubmit=function(){console.log("Submitting registration"),n()&&r.register(m.credentials).error(function(e){t.error("There's already an account registered with that email address","Error")}).then(function(){e.path("/profile")})}}angular.module("packageDelivery").controller("registerCtrl",e),e.$inject=["$location","functionService","toastr"]}(),function(){function e(e,r){var t=function(){return e.get("/api/profile",{headers:{Authorization:"Bearer "+r.getToken()}})};return{getProfile:t}}angular.module("packageDelivery").service("meanData",e),e.$inject=["$http","functionService"]}(),function(){function e(e,r,t,n){var o,s,a,l=function(e){r.localStorage["mean-token"]=e,console.log(e)},d=function(){return r.localStorage["mean-token"]},i=function(){var e,t=d();return t?(e=t.split(".")[1],e=r.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3):(console.log("not logged in"),!1)},c=function(){if(i()){var e=d(),t=e.split(".")[1];return t=r.atob(t),t=JSON.parse(t),{email:t.email,name:t.firstName,lastName:t.lastName,streetNumber:t.streetNumber,streetName:t.streetName,suburb:t.suburb,postCode:t.postCode}}},u=function(){if(i()){var e=d(),t=e.split(".")[1];return t=r.atob(t),t=JSON.parse(t),userEmail=t.email.split("@"),"onthespot.com"!=userEmail[1]?"customer":"admin"==userEmail[0]?"admin":"driver"}};return register=function(r){return console.log("register being called"),e.post("/api/register",r).success(function(e){t.success("Account created","Success"),l(e.token)})},login=function(r){return e.post("/api/login",r).success(function(e){l(e.token),t.success("Login successful","Success")})},updateUser=function(r){return e.put("/api/update/details",r).success(function(e){t.success("Updated profile","Success"),t.hidden("Hidden","Hidden"),l(e.token)})},logout=function(){r.localStorage.removeItem("mean-token"),n.path("/login")},placeOrder=function(r){return e.post("/api/orders/new",r).success(function(e){t.success("Order placed","Success"),t.hidden("Hidden","Hidden")})},getUserOrders=function(r){return e.get("/api/orders",{params:{user:r}}).success(function(e){o=e})},loadOrders=function(){return o},getSingleOrder=function(r){return e.get("/api/singleOrder",{params:{orderID:r}}).success(function(e){s=e})},loadSingleOrder=function(){return s},markJobAsSeen=function(r){return e.put("/api/update/jobSeen",r).success(function(e){})},getCurrentOrders=function(){return e.get("/api/orders/current").success(function(e){o=e})},getDeliveredOrders=function(){return e.get("/api/orders/delivered").success(function(e){o=e})},getPlacedOrders=function(){return e.get("/api/orders/awaiting").success(function(e){o=e})},updateJobState=function(r){return e.put("/api/update/jobstate",r).success(function(e){t.success("Job State Changed","Success"),t.hidden("Hidden","Hidden")})},loadDrivers=function(){return a},getAllDrivers=function(){return e.get("/api/drivers/all").success(function(e){a=e})},assignDriver=function(r){return e.put("/api/orders/assign/driver",r).success(function(e){var r=e.driver.charAt(0).toUpperCase()+e.driver.slice(1);t.success("Assigned to "+r)})},getJobCountForDriver=function(r){return e.get("/api/orders/driver",{params:{driverName:r}}).success(function(e){o=e})},{currentUser:c,saveToken:l,getToken:d,isLoggedIn:i,register:register,login:login,updateUser:updateUser,logout:logout,placeOrder:placeOrder,getUserOrders:getUserOrders,orders:o,loadOrders:loadOrders,getSingleOrder:getSingleOrder,loadSingleOrder:loadSingleOrder,getCurrentOrders:getCurrentOrders,getDeliveredOrders:getDeliveredOrders,getPlacedOrders:getPlacedOrders,order:s,loggedInUserType:u,updateJobState:updateJobState,drivers:a,loadDrivers:loadDrivers,getAllDrivers:getAllDrivers,assignDriver:assignDriver,getJobCountForDriver:getJobCountForDriver,markJobAsSeen:markJobAsSeen}}angular.module("packageDelivery").service("functionService",e),e.$inject=["$http","$window","toastr","$location"]}(),function(){function e(e,r,t){var n=this;n.isLoggedIn=r.isLoggedIn(),n.currentUser=r.currentUser(),console.log(n.currentUser.lastName),console.log(n.currentUser),n.newCredentials={firstName:n.currentUser.name,lastName:n.currentUser.lastName,email:n.currentUser.email,streetNumber:n.currentUser.streetNumber,streetName:n.currentUser.streetName,suburb:n.currentUser.suburb,postCode:n.currentUser.postCode},n.credentials={firstName:n.currentUser.name,lastName:n.currentUser.lastName,email:n.currentUser.email,streetNumber:n.currentUser.streetNumber,streetName:n.currentUser.streetName,suburb:n.currentUser.suburb,postCode:n.currentUser.postCode},n.onSubmit=function(){console.log("Submitting update user details"),console.log(n.credentials),r.register(n.credentials).error(function(e){alert(e)}).then(function(){e.path("profile")})},n.updateUser=function(){r.updateUser(n.newCredentials),e.path("/profile")}}angular.module("packageDelivery").controller("updateUserCtrl",e),e.$inject=["$location","functionService","toastr"]}(),function(){function e(e,r,t){var n=this,o=e.path();n.userType="","/orders"==o?(document.getElementById("myOrders").className="active",document.getElementById("newOrder").className="",document.getElementById("myProfile").className=""):"/orders/new"==o?(document.getElementById("myOrders").className="",document.getElementById("newOrder").className="active",document.getElementById("myProfile").className=""):"/profile"==o?(document.getElementById("myOrders").className="",document.getElementById("newOrder").className="",document.getElementById("myProfile").className="active"):"/admin/dashboard"===o&&(document.getElementById("myOrders").className="",document.getElementById("newOrder").className="",document.getElementById("myProfile").className="",document.getElementById("dashboard").className="active"),n.isLoggedIn=r.isLoggedIn(),n.currentUser=r.currentUser();var s=r.loggedInUserType();switch(s){case"driver":n.userType="driver";break;case"admin":n.userType="admin";break;case"customer":n.userType="customer"}n.logout=function(){r.logout(),t.warning("You have logged out","Warning")}}angular.module("packageDelivery").controller("navigationCtrl",e),e.$inject=["$location","functionService","toastr"]}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("packageDelivery").directive("navigation",e)}();